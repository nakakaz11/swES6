// Generated by CoffeeScript 1.9.2

/* weight base coffee */
"use strict";

(function () {
  var area, area2, brush, brushed, context, focus, height, height2, margin, margin2, parseDate, svg, width, x, x2, xAxis, xAxis2, y, y2, yAxis;
  brushed = function () {
    x.domain(brush.empty() ? x2.domain() : brush.extent());
    focus.select("path").attr("d", area);
    return focus.select(".x.axis").call(xAxis);
  };
  margin = {
    top: 10,
    right: 10,
    bottom: 100,
    left: 40
  };
  margin2 = {
    top: 430,
    right: 10,
    bottom: 20,
    left: 40
  };
  width = 960 - margin.left - margin.right;
  height = 500 - margin.top - margin.bottom;
  height2 = 500 - margin2.top - margin2.bottom;
  parseDate = d3.time.format("%Y-%m-%d").parse;
  x = d3.time.scale().range([0, width]);
  x2 = d3.time.scale().range([0, width]);
  y = d3.scale.linear().range([height, 0]);
  y2 = d3.scale.linear().range([height2, 0]);
  xAxis = d3.svg.axis().scale(x).orient("bottom");
  xAxis2 = d3.svg.axis().scale(x2).orient("bottom");
  yAxis = d3.svg.axis().scale(y).tickSize(width).orient("right");
  brush = d3.svg.brush().x(x2).on("brush", brushed);
  area = d3.svg.area().interpolate("step-after").x(function (d) {
    return x(d.date);
  }).y0(height).y1(function (d) {
    return y(d.price);
  });
  area2 = d3.svg.area().interpolate("monotone").x(function (d) {
    return x2(d.date);
  }).y0(height2).y1(function (d) {
    return y2(d.price);
  });
  svg = d3.select("#svg3").append("svg").attr("width", width + margin.left + margin.right).attr("height", height + margin.top + margin.bottom);
  svg.append("defs").append("clipPath").attr("id", "clipVia").append("rect").attr("width", width).attr("height", height);
  focus = svg.append("g").attr("transform", "translate(" + margin.left + "," + margin.top + ")");
  context = svg.append("g").attr("class", "swCont").attr("transform", "translate(" + margin2.left + "," + margin2.top + ")");
  return d3.csv("/_jsFiddle_/swES6/json/weight.csv", function (error, data) {
    var bisectDate, formatCurrency, formatValue, mousemove, tip;
    data.forEach(function (d) {
      d.date = parseDate(d.date);
      return d.price = +d.price;
    });
    x.domain(d3.extent(data.map(function (d) {
      return d.date;
    })));
    y.domain([0, d3.max(data.map(function (d) {
      return d.price;
    }))]);
    x2.domain(x.domain());
    y2.domain(y.domain());
    focus.append("path").datum(data).attr("clipVia-path", "url(#clipVia)").attr("d", area);
    focus.append("g").attr("class", "x axis").attr("transform", "translate(0," + height + ")").call(xAxis);
    focus.append("g").attr("class", "y axis").call(yAxis);
    focus.selectAll("g").filter(function (d) {
      return d;
    }).classed("minor", true);
    focus.selectAll("text").attr("x", 4).attr("dy", 4);
    tip = svg.append("g").attr("class", "tip").style("display", "none");
    tip.append("circle").attr("r", 4.5);
    tip.append("text").attr("x", -60 - margin.left).attr("dy", ".35em");
    bisectDate = d3.bisector(function (d) {
      return d.date;
    }).left;
    formatValue = d3.format(",.2f");
    formatCurrency = function (d) {
      return "cal." + formatValue(d);
    };
    mousemove = function () {
      var d, d0, d1, i, x0;
      x0 = x.invert(d3.mouse(this)[0]);
      i = bisectDate(data, x0, 1);
      d0 = data[i - 1];
      d1 = data[i];
      d = x0 - d0.date > d1.date - x0 ? d1 : d0;
      tip.attr("transform", "translate(" + (x(d.date) + margin.left) + ", " + (y(d.price) + margin.top) + ")");
      return tip.select("text").text(formatCurrency(d.price));
    };
    svg.append("rect").attr("class", "overlay").attr("width", width).attr("height", height).attr("transform", "translate(" + margin.left + "," + margin.top + ")").on("mouseover", function () {
      return tip.style("display", null);
    }).on("mouseout", function () {
      return tip.style("display", "none");
    }).on("mousemove", mousemove);
    context.append("path").datum(data).attr("d", area2);
    context.append("g").attr("class", "x axis").attr("transform", "translate(0," + height2 + ")").call(xAxis2);
    return context.append("g").attr("class", "x brush").call(brush).selectAll("rect").attr("y", -6).attr("height", height2 + 7);
  });
})();

//# sourceMappingURL=viaBrushing.js.map

//# sourceMappingURL=viaBrushing-compiled.js.map